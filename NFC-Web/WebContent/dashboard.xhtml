<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough"

      xmlns:pretty="http://ocpsoft.com/prettyfaces"
>


<ui:composition template="/templates/template.xhtml">

    <ui:define name="title">

        <h:outputText rendered="#{authBean.impersonationEmail eq null }" value="Hikes"/>
        <h:outputText rendered="#{authBean.impersonationEmail ne null}"
                      value="#{authBean.authenticatedUser} IMPERSONATED"/>

    </ui:define>
    <!--<ui:define name="meta">-->
    <!--<f:metadata>-->
    <!--<o:enableRestorableView/>-->
    <!--</f:metadata>-->
    <!--</ui:define>-->
    <ui:define name="stylesheets">
        <h:outputStylesheet library="css" name="/leaflet/leaflet.css"></h:outputStylesheet>
        <h:outputStylesheet library="css"
                            name="/leaflet/plugins/fullscreen/Control.FullScreen.css"></h:outputStylesheet>
        <h:outputStylesheet library="css" name="/leaflet/plugins/geocoder/Control.Geocoder.css"></h:outputStylesheet>
    </ui:define>
    <ui:define name="content">

        <f:metadata>
            <f:viewAction action="#{userBean.init()}"/>
            <f:viewAction action="#{hikeBean.init()}"/>
        </f:metadata>
        <!-- ################################################################################## -->
        <div class="ui-g">
            <div class="ui-g-0 ui-md-1 ui-lg-2"></div>
            <div class="container-fluid ui-g-12 ui-md-10 ui-lg-8">
                <b:row>
                    <h:form id="form">
                        <p:dataGrid widgetVar="myHikesWidget" var="currentHikeBean" value="#{userBean.hikesPlusButton}"
                                    columns="3" layout="grid"
                                    rows="12" paginator="true" id="hikeBeans"
                                    paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                    rowsPerPageTemplate="6,12,16">

                            <f:facet name="header">
                                #{msg['label_myHikes']}
                                <h:outputText
                                        rendered="#{ request.isUserInRole('ADMINISTRATOR') and authBean.impersonatedUser.id ne null }"
                                        value=" -  #{authBean.authenticatedUser} IMPERSONATED #{authBean.impersonatedUser} "/>
                            </f:facet>

                            <p:panel rendered="#{currentHikeBean.hike.id eq 0}" style="height: 100%">
                                <p:commandLink
                                        styleClass="ui-button-text ui-c ui-button-icon-left ui-icon ui-c fa fa-fw fa-plus"
                                        oncomplete="PF('createHikeWidget').show()"
                                        update="@widgetVar(createHikeWidget)">
                                    <f:setPropertyActionListener value="#{currentHikeBean.hike}"
                                                                 target="#{hikeBean.hike}"/>

                                </p:commandLink>
                                <f:facet name="footer">
                                    <p:outputLabel value="Add a new Hike"></p:outputLabel>
                                </f:facet>
                            </p:panel>

                            <p:panel header="#{currentHikeBean.hike.title}"
                                     rendered="#{currentHikeBean.hike.id ne 0}" style="text-align:center">
                                <f:facet name="footer">
                                    <p:outputLabel value="created: "></p:outputLabel>
                                    <p:outputLabel value="#{currentHikeBean.hike.createdAt}"></p:outputLabel>

                                </f:facet>
                                <!--<h:outputText value="#{currentHikeBean.hike.description}"/>-->
                                <!--<h:outputText value="#{currentHikeBean.hike.publicurl}"/>-->
                                <h:panelGrid columns="3" style="width:100%">


                                    <h:column>
                                        <p:commandLink id="btnHikeShow"
                                                styleClass="ui-button-text ui-c ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only"
                                                oncomplete="PF('createHikeWidget').show()"
                                                update="@widgetVar(createHikeWidget)">
                                            <f:setPropertyActionListener value="#{currentHikeBean.hike}"
                                                                         target="#{hikeBean.hike}"/>
                                            <h:panelGroup
                                                    styleClass="ui-button-icon-left ui-icon ui-c fa fa-fw fa-eye"></h:panelGroup>
                                            <h:panelGroup styleClass="ui-button-text ui-c"></h:panelGroup>
                                        </p:commandLink>
                                        <p:tooltip id="toolTipBtnHikeShow" widgetVar="hikeToolTipVar_show_#{currentHikeBean.hike.id}"
                                                   for="btnHikeShow" value="show" position="top"
                                                   hideEvent="mouseleave  click"/>
                                    </h:column>

                                    <h:column>
                                        <pretty:link mappingId="hikeCreate" type="button" id="btnHikeEdit"
                                                     styleClass="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only">
                                            <f:param value="#{currentHikeBean.hike.publicurl}"/>
                                            <h:panelGroup
                                                    styleClass="ui-button-icon-left ui-icon ui-c fa fa-fw fa-pencil"></h:panelGroup>
                                            <h:panelGroup styleClass="ui-button-text ui-c"></h:panelGroup>
                                        </pretty:link>
                                        <p:tooltip id="toolTipBtnHikeEdit" widgetVar="hikeToolTipVar_edit_#{currentHikeBean.hike.id}"
                                                   for="btnHikeEdit" value="edit" position="top"
                                                   hideEvent="mouseleave  click"/>
                                    </h:column>
                                    <h:column>
                                        <p:commandButton id="btnHikeDelete" a:data-delete-button="delete"
                                                         update="messageGrowl @widgetVar(myHikesWidget)"
                                                         styleClass="#{hikeBean.hikeToBeDeleted.id eq currentHikeBean.hike.id ? 'markDeletion' : 'light-red-button'}"
                                                         icon="fa fa-trash"
                                                         actionListener="#{hikeBean.deleteHike(currentHikeBean.hike)}"
                                                         onclick="#{hikeBean.hikeToBeDeleted.id eq currentHikeBean.hike.id ? 'removeMarkAndToolTip(event,true)' : 'removeMarkAndToolTip(event,false)'}"
                                        >

                                        </p:commandButton>

                                        <p:tooltip rendered="#{hikeBean.hikeToBeDeleted.id ne currentHikeBean.hike.id}"
                                                   id="toolTipbtnHikeDelete"
                                                   widgetVar="hikeToolTipVar_delete_#{currentHikeBean.hike.id}"
                                                   for="btnHikeDelete" hideEvent="mouseleave   click"
                                                   value="delete"
                                                   position="top"/>

                                        <p:tooltip rendered="#{hikeBean.hikeToBeDeleted.id eq currentHikeBean.hike.id }"
                                                   id="toolTipbtnHikeDeleteSure"
                                                   widgetVar="hikeToolTipVar_deleteSure_#{currentHikeBean.hike.id}"
                                                   for="btnHikeDelete" hideEvent="mouseleave   click"
                                                   value="SICHER?"
                                                   position="top"/>
                                    </h:column>
                                </h:panelGrid>
                            </p:panel>

                        </p:dataGrid>
                        <!--<div class="container-fluid ui-g-12 ui-md-10 ui-lg-8">-->

                        <!-- </div>-->


                        <p:remoteCommand name="clearToBeDeletedHike"
                                         actionListener="#{hikeBean.clearToBeDeletedHike}"/>

                        <p:remoteCommand name="updatePrimefacesWidget" process="@this"
                                         actionListener="#{primefacesView.setToBeRefreshedWidget()}"
                                         update="@widgetVar(myHikesWidget)"/>


                    </h:form>
                </b:row>
            </div>
            <div class="ui-g-0 ui-md-1 ui-lg-2"></div>
        </div>
    </ui:define>
    <ui:define name="dialogs">
        <h:form>
            <p:dialog id="createHike" widgetVar="createHikeWidget" minWidth="400" closable="true"
                      minHeight="400" dynamic="true"
                      modal="true" resizable="false"
                      fitViewport="true" draggable="false" closeOnEscape="true" responsive="true">
                <ui:include src="forms/createHikeDialog.xhtml"/>
            </p:dialog>

            <p:dialog id="choosePointDialogHikeWidget" class="ui-grid-col-12"
                      widgetVar="choosePointDialogHikeWidget" closable="true"
                      onShow="choosePointDialog(); PF('choosePointDialogHikeWidget').initPosition();"
                      header="Ort wählen" modal="true" resizable="x" dynamic="true" draggable="false"
                      closeOnEscape="true" responsive="true">
                <ui:include src="forms/choosePointDialogHike.xhtml"/>
            </p:dialog>
        </h:form>
    </ui:define>
    <ui:define name="scripts">
        <!--<h:outputScript library="js" name="https://www.google.com/recaptcha/api.js"></h:outputScript>-->
        <h:outputScript library="js" name="/leaflet/leaflet-src.js"></h:outputScript>
        <h:outputScript library="js" name="/leaflet/plugins/wfs/leaflet-wfst.min.js"></h:outputScript>
        <h:outputScript library="js" name="/leaflet/plugins/wms/leaflet.wms.js"></h:outputScript>
        <h:outputScript library="js" name="/leaflet/plugins/geocoder/Control.Geocoder.js"></h:outputScript>
        <h:outputScript library="js" name="/leaflet/plugins/fullscreen/Control.FullScreen.js"></h:outputScript>
        <h:outputScript library="js" name="/choosePointDialog.js"></h:outputScript>

    </ui:define>
</ui:composition>
</html>