<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core"

>

<ui:composition template="/templates/template.xhtml">
    <ui:define name="title">Startseite | Userverwaltung</ui:define>

    <ui:define name="content">
        <h:form>
            <f:metadata>
                <f:viewAction action="#{userIndexBean.init()}"/>
            </f:metadata>
            <p:growl id="userGrowl" showDetail="true" life="2000"/>

            <div class="ui-fluid">
                <p:dataTable var="user" widgetVar="userTableWidget"  value="#{userIndexBean.userBeans}">
                    <p:column headerText="ID">
                        <h:outputText value="#{user.id}"/>
                    </p:column>

                    <p:column headerText="Username">
                        <h:outputText value="#{user.username}"/>
                    </p:column>
                    <p:column headerText="E-Mail-Adresse">
                        <h:outputText value="#{user.email}"/>
                    </p:column>
                    <p:column headerText="Vorname">
                        <h:outputText value="#{user.firstname}"/>
                    </p:column>
                    <p:column headerText="Nachname">
                        <h:outputText value="#{user.lastname}"/>
                    </p:column>
                    <p:column headerText="Erstellt am">
                        <h:outputText value="#{user.createdAt}"/>
                    </p:column>
                    <p:column headerText="Hikes">
                        <h:outputText value="#{user.hikeCount}"/>
                    </p:column>
                    <p:column headerText="Aktion">
                        <!--<h:column>-->
                        <!--<pretty:link mappingId="hikeView" type="button"-->
                        <!--styleClass="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only">-->
                        <!--<f:param value="#{currentHikeBean.hike.publicurl}"/>-->
                        <!--<h:panelGroup-->
                        <!--styleClass="ui-button-icon-left ui-icon ui-c fa fa-fw fa-eye"></h:panelGroup>-->
                        <!--<h:panelGroup styleClass="ui-button-text ui-c"></h:panelGroup>-->
                        <!--</pretty:link>-->
                        <!--</h:column>-->

                        <!--<h:column>-->
                        <!--<pretty:link mappingId="hikeCreate" type="button"-->
                        <!--styleClass="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only">-->
                        <!--<f:param value="#{currentHikeBean.hike.publicurl}"/>-->
                        <!--<h:panelGroup-->
                        <!--styleClass="ui-button-icon-left ui-icon ui-c fa fa-fw fa-pencil"></h:panelGroup>-->
                        <!--<h:panelGroup styleClass="ui-button-text ui-c"></h:panelGroup>-->
                        <!--</pretty:link>-->
                        <!--</h:column>-->


                        <p:commandButton id="btnUserImpersonate"
                                rendered="#{ request.isUserInRole('ADMINISTRATOR') }" icon="fa fa-user-secret"
                                styleClass="light-green-button"
                                update="@form"
                                         disabled="#{authBean.authenticatedUser.email eq user.email or authBean.impersonatedUser.email eq user.email }"
                                value="#{authBean.impersonatedUser.email eq user.email ? 'CURRENT': authBean.authenticatedUser.email eq user.email?'THIS IS YOU':null}"
                                action="#{authBean.impersonateUser(user.email)}"  >
                        </p:commandButton>
                        <p:tooltip rendered="#{  authBean.authenticatedUser.email ne user.email and  authBean.impersonatedUser.email ne user.email }"
                                   id="toolTipBtnUserImpersonate" widgetVar="userToolTipVar_impersonate_#{user.id}"
                                   for="btnUserImpersonate" hideEvent=" mouseleave click" value="impersonate"
                                   position="top"/>

                        <p:commandButton id="btnUserDelete" a:data-delete-button="delete"
                                         update="@form" disabled="#{authBean.authenticatedUser.email eq user.email}"
                                         styleClass="#{userBean.userToBeDeleted.id eq user.id ? 'markDeletion' :  'light-red-button'}"
                                         icon="fa fa-trash" actionListener="#{userBean.delete(user)}" process="@this"
                                         onclick="#{userBean.userToBeDeleted.id eq user.id ? 'removeMarkAndToolTip(event,true)' : 'removeMarkAndToolTip(event,false)'}">
                        </p:commandButton>


                        <p:tooltip rendered="#{userBean.userToBeDeleted.id  ne user.id}"
                                   id="toolTipBtnUserDelete" widgetVar="userToolTipVar_delete_#{user.id}"
                                   for="btnUserDelete" hideEvent=" mouseleave click" value="delete"
                                   position="top"/>
                        <p:tooltip rendered="#{userBean.userToBeDeleted.id eq user.id}"
                                   id="toolTipBtnUserDeleteSure"
                                   widgetVar="userToolTipVar_deleteSure_#{user.id}"
                                   for="btnUserDelete" hideEvent="mouseleave   click" value="SICHER?"
                                   position="top"/>

                        <!--<pretty:link -->
                        <!--mappingId="impersonateUser" type="button"-->
                        <!--styleClass="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only">-->
                        <!--<f:param value="#{user.email}"/>-->
                        <!--<h:panelGroup-->
                        <!--styleClass="ui-button-icon-left ui-icon ui-c fa fa-fw fa-pencil"></h:panelGroup>-->
                        <!--<h:panelGroup styleClass="ui-button-text ui-c"></h:panelGroup>-->
                        <!--</pretty:link>-->
                        <!--<h:link-->
                        <!--rendered="#{ request.isUserInRole('ADMINISTRATOR') }"-->
                        <!--outcome="/deleteHike" value="#{msg.btnLabel_erase}"-->
                        <!--styleClass="btn-danger btn">-->
                        <!--<f:param name="id" value="#{user.id}"></f:param>-->
                        <!--</h:link>-->

                        <!--<a href="hike/#{currentHikeBean.hike.publicurl}">#{msg['btnLabel_showHike']}</a>-->
                        <!--<h:commandButton value="anzeigen" icon="ui-icon-info" action="#{hikeBean.hike.setPublicurl(currentHikeBean.hike.publicurl)}"></h:commandButton>-->
                        <!--<p:commandButton value="edit" icon="ui-icon-pencil" action="pretty:hikeCreate"><f:param name="id" value="#{currentHikeBean.hike.publicurl}"/></p:commandButton>-->


                        <!--<a href="create/#{currentHikeBean.hike.publicurl}">#{msg['btnLabel_editHike']}</a>-->

                    </p:column>
                </p:dataTable>
            </div>

            <p:remoteCommand name="clearToBeDeletedUser"
                             actionListener="#{userBean.clearToBeDeletedUser}"/>

            <p:remoteCommand name="updatePrimefacesWidget" process="@this"
                             actionListener="#{primefacesView.setToBeRefreshedWidget()}"
                             update="@widgetVar(userTableWidget)"/>

        </h:form>
    </ui:define>
</ui:composition>
</html>